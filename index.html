<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Interaktywny Układ Słoneczny</title>
		<link href="style.css" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" type="image/x-icon" href="icons/favicon.png">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" 
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" 
        crossorigin="anonymous">
	</head>
	<body>

		<!-- ---------------- Custom Shader Code ------------------------ -->
		<script id="vertexShader" type="x-shader/x-vertex">
			uniform vec3 viewVector;
			uniform float c;
			uniform float p;
			varying float intensity;
			void main() 
			{
				vec3 vNormal = normalize( normalMatrix * normal );
				vec3 vNormel = normalize( normalMatrix * viewVector );
				intensity = pow( abs(c - dot(vNormal, vNormel) ), p );
		
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}
			</script>
		
			<!-- fragment shader a.k.a. pixel shader -->
			<script id="fragmentShader" type="x-shader/x-vertex"> 
			uniform vec3 glowColor;
			varying float intensity;
			void main() 
			{
				vec3 glow = glowColor * intensity;
				gl_FragColor = vec4( glow, 1.0 );
			}
		</script>
	<!-- ----------------------------------------------------------- -->

		<div class="show" id="settingspanel" >
			<div id="settingsbtn" class="settingsbtnclass" onclick="togglesettingsbar()"></div>
			<div class="dateinfo" id="infodate"></div>
			<div class="eventinfo"></div>
                <div class="row">
                    <ul>
                        <li><a class="settings_button" onclick="minusyear()"><img src="icons/my.png" alt="-Y"></i></a></li>
                        <li><a class="settings_button" onclick="minusmonth()"><img src="icons/mm.png" alt="-M"></a></i></li>
                        <li><a class="settings_button" onclick="minusday()"><img src="icons/minus.png" alt="+"></a></li>
                        <li><a id="pp" class="settings_button playpause paused" onclick='toggleanimation();'></a></li>
                        <li><a class="settings_button" onclick="plusday(); removealltrails();"><img src="icons/plus.png" alt="+"></a></li>
                        <li><a class="settings_button" onclick="plusmonth()"><img src="icons/pm.png" alt="+M"></a></i></li>
                        <li><a class="settings_button" onclick="plusyear()"><img src="icons/py.png" alt="+Y"></a></i></li>
                    </ul>
                </div>
                <div class="row">
                    <p class="podajdate">Podaj datę:</p><input type="date" id="data" class="datepickerfield" placeholder="Wybierz Datę">
					<a class="settings_button sd" onclick="ustawczas()">Potwierdź datę</a>
				</div>
				<div class="row">
					<div class="slidecontainer">
						<p>Skala rozmiaru planet:</p>
						<a class="realscale" id="realpscale" onclick="realscaleset()">Realna</a>
						<a class="resetskali" id="scalereset" onclick="scalereset()">Reset</a>
						<input type="range" min="0.5" max="5" value="1" step="0.1" class="slider" id="psizerange">
						<div id="rangeval"></div>
					</div>
				</div>
				<div class="row">
					<div class="labelsvisibility visibilitycontainer">
						<p>Pokaż/ukryj nazwy planet: </p>
						<input type="checkbox" id="labelview" name="" checked onclick="labelview()">
					</div>
				</div>
				<div class="row">
					<div class="starsvisibility  visibilitycontainer">
						<p>Pokaż/ukryj gwiazdy: </p>
						<input type="checkbox" id="starsview" name="" checked onclick="togglestars(this)">
					</div>
				</div>
				<div class="row">
					<div class="asteroidsvisibility  visibilitycontainer">
						<p>Pokaż/ukryj pas asteroid: </p>
						<input type="checkbox" id="asteroidcheckbox" name="" checked onclick="asteroidview()">
					</div>
				</div>
				<div class="row">
					<div class="orbitconfigcontainer">
						<div class="allorbitcheck visibilitycontainer" >
							<p>Pokaż/ukryj wszystkie orbity: </p>
							<input type="checkbox" id="orbitview" checked onclick="togglealltrails(this)"></div>
						<div class="specifiedorbitchecks">
							<div><p>M</p><input class="pcheck" type="checkbox" name="" id="" checked onclick="toggletrail(metr, this)"></div>
							<div><p>W</p><input class="pcheck" type="checkbox" name="" id="" checked onclick="toggletrail(vetr, this)"></div>
							<div><p>Z</p><input class="pcheck" type="checkbox" name="" id="" checked onclick="toggletrail(eatr, this)"></div>
							<div><p>M</p><input class="pcheck" type="checkbox" name="" id="" checked onclick="toggletrail(matr, this)"></div>
							<div><p>J</p><input class="pcheck" type="checkbox" name="" id="" checked onclick="toggletrail(jutr, this)"></div>
							<div><p>S</p><input class="pcheck" type="checkbox" name="" id="" checked onclick="toggletrail(satr, this)"></div>
							<div><p>U</p><input class="pcheck" type="checkbox" name="" id="" checked onclick="toggletrail(urtr, this)"></div>
							<div><p>N</p><input class="pcheck" type="checkbox" name="" id="" checked onclick="toggletrail(netr, this)"></div>
						</div>
					</div>
				</div>
				<div class="row">
					<p>Koniunkcje z Ziemią:</p>	
					<div class="buttonscontainer">
						<button class="listbtn" id="listmars" onclick="showmarslist(this)">Marsa</button>
						<button class="listbtn" id="listjupiter" onclick="showjupiterlist(this)">Jowisza</button>
						<button class="listbtn" id="listsaturn" onclick="showsaturnlist(this)">Saturna</button>
						<button class="listbtn" id="listuranus" onclick="showuranuslist(this)">Urana</button>
						<button class="listbtn" id="listneptune" onclick="showneptunelist(this)">Neptuna</button>
					</div>
					<div class="listcontainer coniunctionslists">
						<ul class="conlist" id="marslist"></ul>
						<ul class="conlist" id="jupiterlist"></ul>
						<ul class="conlist" id="saturnlist"></ul>
						<ul class="conlist" id="uranuslist"></ul>
						<ul class="conlist" id="neptunelist"></ul>
					</div>
				</div>
                <!-- <div class="timestatus">
                    <div class="tstat"></div>
                    <input type="checkbox" id="play" checked>
                </div> -->
			</div>
		</div>
		<div id="info">
			Symulator eksploracji układu słonecznego - v19<br>
			Upływ czasu: <p id="timespeed"></p> dni / sekundę <br>
			Prędkośc obrotu planet wokół własnej osi spowolnione <p id="slowdown"></p> krotnie.
		</div>

		<!-- INFORMACJE O PLANECIE -->
		<div id="pinfocontainer">
			<div id="tinfop" onclick="hideasidebar(); showalltrails(); showlabels();"><div id="asidebtn"></div></div>
			<div id="planetinfopanel" class="">
						<div id="pname">Nazwa</div>
						<div id="plive">
							<div id="canvas"></div>
						</div>
						<div class="descriptioncontainer">
							<div class="container">
								<h class="category">Opis</h>
								<div id="description"></div>
							</div>
							<div class="container">
								<h class="category">Okres obiegu wokół Słońca</h>
								<div id="yearlength"></div>
							</div>
							<div class="container">
								<h class="category">Długość dnia</h>
								<div id="daytime"></div>
							</div>
							<div class="container">
								<h class="category">Temperatura</h>
								<div id="temperature"></div>
							</div>
							<div class="container">
								<h class="category">Powierzchnia</h>
								<div id="surface"></div>
							</div>
							<div class="container">
								<h class="category">Księżyce</h>
								<div id="moons"></div>
							</div>
							<div class="container">
								<h class="category">Średnica</h>
								<div id="diameter"></div>
							</div>
							<div class="container">
								<h class="category">Czas 'lotu' światła ze Słońca</h>
								<div id="lighttime"></div>
							</div>
							<div class="container">
								<h class="category">Prędkość orbitalna</h>
								<div id="meanvelocity"></div>
							</div>
						</div>
					</div>
		</div>

		</div>
		<div class="resetcamera">
			<a id="cameraresetbtn" 
			onclick="cameratween(camToSave.position, camToSave.rotation, camToSave.controlCenter)">
			RESET KAMERY
			</a>
		</div>
		<div id="toggler">
			<p class="pcdesc">Porównanie realnych </p>
			<p id="chosen">wielkości</p>
			<p>planet względem siebie.</p>
			<button id="sizes" onclick="showsizes()" class="hiddentogglerbtn">SKALA WIELKOŚCI</button>
			<button id="distances" onclick="showdistances()" class="">SKALA ODLEGŁOŚCI</button>
		</div>

		<div class="planetscomparison ">
			<div class="planetsizecntainer">
				<div class="slabel">Słońce</div>
				<div class="planet" id="sun" onclick="showasidebar();toggleinfobar(sun, sundata); hidealltrails();"></div>
			</div>
			<div class="planetsizecontainer">
				<div class="plabel">Merkury</div>
				<div class="hitbox" id="mercuryhitbox" onclick="showasidebar();toggleinfobar(mercury, mercurydata); hidealltrails();">
					<div class="planet" id="mercury"></div>
				</div>
			</div>
			<div class="planetsizecontainer">
				<div class="plabel">Wenus</div>
				<div class="hitbox" id="venushitbox" onclick="showasidebar();toggleinfobar(venus, venusdata); hidealltrails();">
					<div class="planet" id="venus"></div>
				</div>
			</div>
			<div class="planetsizecontainer">
					<div class="plabel">Ziemia</div>
				<div class="hitbox" id="earthhitbox" onclick="showasidebar();toggleinfobar(earth, earthdata); hidealltrails();">
					<div class="planet" id="earth"></div>
				</div>
			</div>
			<div class="planetsizecontainer">
					<div class="plabel">Mars</div>
				<div class="hitbox" id="marshitbox" onclick="showasidebar();toggleinfobar(mars, marsdata); hidealltrails();">
					<div class="planet" id="mars"></div>
				</div>
			</div>
			<div class="planetsizecontainer">
					<div class="plabel">Jowisz</div>
					<div class="hitbox" id="jupiterhitbox" onclick="showasidebar();toggleinfobar(jupiter, jupiterdata); hidealltrails();">
				<div class="planet" id="jupiter"></div></div>
			</div>
			<div class="planetsizecontainer">
					<div class="plabel">Saturn</div>
					<div class="hitbox" id="saturnhitbox" onclick="showasidebar();toggleinfobar(saturn, saturndata); hidealltrails();">
				<div class="planet" id="saturn"></div></div>
			</div>
			<div class="planetsizecontainer">
					<div class="plabel">Uran</div>
					<div class="hitbox" id="uranushitbox" onclick="showasidebar();toggleinfobar(uranus, uranusdata); hidealltrails();">
				<div class="planet" id="uranus"></div></div>
			</div>
			<div class="planetsizecontainer">
					<div class="plabel">Neptun</div>
					<div class="hitbox" id="neptunehitbox" onclick="showasidebar();toggleinfobar(neptune, neptunedata); hidealltrails();">
				<div class="planet" id="neptune"></div></div>
			</div>
		</div>

		<div class="distancescomparison slideddown">
			<div id="sundist" class="pdist"><p>Słońce</p></div>
			<div id="mercurydist" class="pdist"><p>Merkury</p></div>
			<div id="venusdist" class="pdist"><p>Wenus</p></div>
			<div id="earthdist" class="pdist"><p>Ziemia</p></div>
			<div id="marsdist" class="pdist"><p>Mars</p></div>
			<div id="asteroiddist" class="pdist"><p>Pas&nbsp;asteroid</p></div>
			<div id="jupiterdist" class="pdist"><p>Jowisz</p></div>
			<div id="saturndist" class="pdist"><p>Saturn</p></div>
			<div id="uranusdist" class="pdist"><p>Uran</p></div>
			<div id="neptunedist" class="pdist"><p>Neptun</p></div>
		</div>

		<script src="js/three.js"></script>
		<script src="datesettings.js"></script> <!--funkcje zmiany czasu-->
		<!-- <script src="positionscounting.js"></script>obliczanie pozycji planet -->
		<script src="poscount.js"></script>
		<script src="eclipticcoordinates.js"></script>
		<script src="gui.js"></script><!--interakcje z interface-->
		<script src="trails.js"></script>
		<script src="js/Projector.js"></script>
		<script src="js/Tween.js" ></script>
		<script src="js/Orbitcontrols.js" ></script>
		<script src="coniunctions.js"></script>
		<script src="//unpkg.com/three-spritetext" ></script>
		<script src="js/GLTFLoader.js"></script>
		<script>

			let planet;
			// let worker = new Worker('work.js');
			// deaktywuje animacje gdy karta przegladarki nie jest aktywna
			let doanimate = true;
			let tabfocus = true;
			window.onfocus = () => {
				tabfocus = true;
				// console.log("Focus!");
			}
			window.onblur = () => {
				tabfocus = false;
				// console.log("Blur!");
			}

			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// DEKLARACJE ZMIENNYCH (dla czystości kodu)
			
			// zmienne do wyliczania pozycji planet
			let sundata = {id: 0, name: 'Słońce' , axistilt: 0,  yearlength: 'Nie dotyczy' , daylength: 'Nie dotyczy', averagetemp: 'Około 5505°C', surface: 'Gorąca plazma', moons: 'Nie posiada', 
			diameter: '1 392 684 km', lighttime: '0 sekund', meanvelocity: 'Według różnych źródeł od 213-250 km/s', description: 'Centralna gwiazda naszego układu planetarnego'};
			let mercurydata = 
			{id: 1, name: 'Merkury' , ows: 365*0.25, ink: 7.00507,an: 48.3339,ph: 77.454,md: 0.3870978,dm: 4.092353,eksorb: 0.2056324,ml: 314.42369, axistilt: 0, 
			yearlength: '88 dni' , daylength: '58.6 dni', averagetemp: 'Od -173.15°C do 426.85°C', 
			surface: 'Stała/Kamienna', moons: 'Nie posiada', 
			diameter: '4879,4 km', lighttime: 'Około 3 minuty', meanvelocity: '170 503 km/h', description: 'Najbliższa Słońcu planeta. Jest tylko odrobinę większy niż ziemski Księżyc. Nie posiada atmosfery przez co wszelkie meteoryty mogą w niego bez przeszkód uderzać. Jest to planeta o największej prędkości obiegu wokół Słońca, natomiast za to obraca się wokół własnej osi niebywale wolno.'};
			let venusdata = 
			{id: 2, name: 'Wenus' , ows: 365*0.7, ink: 3.39472,an: 76.6889,ph: 131.761,md: 0.7233238,dm: 1.602158,eksorb: 0.0067933,ml: 236.94045, axistilt: 177.3,
			yearlength: '224.7 dni', daylength: '243 dni', averagetemp: 'Około 465°C', surface: 'Kamienista/Stała, pokryta wulkanami i ogromnymi górami.', moons: 'Nie posiada', 
			diameter: '12 104 km', lighttime: 'Około 6 minut', meanvelocity: '126 074 km/h', description: 'Ciekawostką na temat tej planety jest to, że obraca się ona w przeciwnym kierunku niż pozostałe planety, ponadto robi to bardzo powoli. Posiada bardzo grubą atmosferę blokującą spadek jej temperatury w związku z czym jest ona najgorętszą planetą Układu Słonecznego.'};
			let earthdata = 
			{id: 3, name: 'Ziemia' , ows: 365, ink: 0.00041,an: 349.2,ph: 102.8517,md: 1,dm: 0.9855796,eksorb: 0.0166967,ml: 328.40353, axistilt: 23.44, 
			yearlength: '365.25 dni', daylength: '24 godziny', averagetemp: 'Od -81°C do 47°C', surface: 'Skalna/Stała', moons: 'Posiada jeden księżyc', 
			diameter: '12 742 km', lighttime: 'Około 8 minut', meanvelocity: '107 218 km/h', description: 'Nasza ojczysta planeta. Jedyna w Układzie Słonecznym zamieszkana przez żywe organizmy. Dodatkowo również jako jedyna posiada na swojej powierzchni wodę w stanie ciekłym.'};
			let marsdata = 
			{id: 4, name: 'Mars' , ows: 365*2, ink: 1.84992,an: 49.5664,ph: 336.0882,md: 1.5236365,dm: 0.5240613,eksorb: 0.0934231,ml: 262.42784, axistilt: 25.2,
			yearlength: '687 dni', daylength: '24 godziny 39 minut', averagetemp: 'Od -133°C do 27°C', surface: 'Stała/Kamienna', moons: 'Posiada 2 księżyce: Phobos i Deimos', 
			diameter: '6779 km', lighttime: 'Około 14 minut', meanvelocity: '86 677 km/h', description: 'Jest bardzo pylastą planetą o niezwykle cienkiej atmosferze i niewielkich rozmiarach. Temperatury na Marsie są bardzo niskie. Badacze odkryli, że w bardzo odłegłej przeszłości posiadał na swojej powierzchni wodę, miał grubszą atmosferę i wyższe średnie temperatury.'};
			let jupiterdata = 
			{id: 5, name: 'Jowisz' , ows: 365*12, ink: 1.30463,an: 100.4713,ph: 15.6978,md: 5.202597,dm: 0.08309618,eksorb: 0.0484646,ml: 322.55983, axistilt: 3.1,
			yearlength: '11.86 roku (4333 dni)', daylength: '9 godzin', averagetemp: 'Od -145°C do -137°C', surface: 'Gazowa', moons: 'Posiada ponad 75 księżyców', 
			diameter: '139 820 km', lighttime: 'Około 44 minuty', meanvelocity: '47 002 km/h', description: 'Jego masa ponad dwukrotnie przewyższa zsumowane masy wszystkich pozostałych planet Układu Słonecznego. Jest to ogromny gazowy gigant. Ponadto pomimo swojego gargantuicznego rozmiaru - wykonuje pełny obrót wokół własnej osi w zaskakująco niskim czasie.'};
			let saturndata = 
			{id: 6, name: 'Saturn' , ows: 365*30, ink: 2.48524,an: 113.6358,ph: 88.863,md: 9.5719,dm: 0.03328656,eksorb: 0.0531651,ml: 20.95759, axistilt: 26.7,
			yearlength: '10.76 roku (3930 dni)', daylength: '10 godzin 33 minuty', averagetemp: 'Około 165°C', surface: 'Gazowa', moons: 'Posiada 53 znane księżyce i 9 oczekujących potwierdzenia (łącznie 62)', 
			diameter: '116 460 km', lighttime: 'Około 84 minuty', meanvelocity: '34 701 km/h', description: 'Planeta gazowa o dużej średnicy, nie tylko on posiada pierścienie wokół swojej bryły ale jako jedyny posiada te pierścienie aż tak spektakularne. Jego pierścienie składają się z lodu i skał. Składa się głównie z wodoru i helu.'};
			let uranusdata = 
			{id: 7, name: 'Uran' , ows: 365*165, ink: 0.77343,an: 74.0954,ph: 175.6807,md: 19.30181,dm: 0.01162295,eksorb: 0.0428959,ml: 303.18967, axistilt: 97.8,
			yearlength: '84 lata (30 689 dni)', daylength: '17 godzin 14 minut', averagetemp: 'Około -210°C', surface: 'Lodowa', moons: 'Posiada 27 znanych księżyców oraz 13 pierścieni ', 
			diameter: '50 724 km', lighttime: 'Około 165 minut', meanvelocity: '24 477 km/h', description: 'Planeta odkryta najpóźniej, dopiero w 1781 roku. Chmury gazowe na jego powierzchni składają się z tego samego gazu jaki ulatnia się ze zgniłych jaj. Obraca się wokół własnej osi pod kątem prawie 90 stopni. Posiada krótki dzień i bardzo długi rok. Również posiada pierścienie ale nie są tak widoczne jak te Saturna.'};
			let neptunedata = 
			{id: 8, name: 'Neptun' , ows: 365*249, ink: 1.7681,an: 131.7925,ph: 7.206,md: 30.26664,dm: 0.005919282,eksorb: 0.0102981,ml: 299.8641, axistilt: 28.3,
			yearlength: '164.8 roku (60 182 dni)', daylength: '16 godzin 6 minut', averagetemp: 'Około -227°C', surface: 'Lodowa', moons: 'Posiada 13 księżyców oraz 6 pierścieni', 
			diameter: '49 244 km', lighttime: 'Około 250 minut', meanvelocity: '19 566 km/h', description: 'Ósma, najodleglejsza od Słońca planeta. Ciemna, zimna a na jej powierzchni szaleją niesamowicie potężne wichury. Pierwsza planeta odkryta za pomocą matematycznych obliczeń. Jej odległość od Słońca jest ponad 30 razy większa od tej dzielącej Słońce od Ziemii. Jest lodowym gigantem.'};


			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// INICJALIZACJA SCENY I WSTĘPNA KONFIGURACJA ORBITCONTROLS ITD

			// WSTĘPNE USTAWIENIE CZASU
			// ustawianie domyslnie dzisiejszej daty w datepicker
			let delay = 1000;
			let date = new Date();	
			let b2 = date.getFullYear(); //year
			let b3 = date.getMonth()+1; //month
			let b4 = date.getDate(); //day
			let b5 = date.getHours(); //hours
			let b6 = date.getMinutes(); //minutes
			let strdate = b4+" " +miesiace[b3-1]+" "+b2+" r";
			document.getElementById("infodate").innerHTML = "Data: "+strdate;
			window.setInterval( function() {
				if (document.hidden == false) {
					if (animationstate == true) {
						b2 = date.getFullYear(); //year
						b3 = date.getMonth()+1; //month
						b4 = date.getDate(); //day
						b5 = date.getHours(); //hours
						b6 = date.getMinutes(); //minutes
						date.setDate(date.getDate()+1);
						strdate = b4+" " +miesiace[b3-1]+" "+b2+" r";
						document.getElementById("infodate").innerHTML = "Data: "+strdate;
						// checkevent();
					}
				}
			}, delay);

			// utworzenie sceny i kamery, rozmiar uniwersum
			let unisize = 1500; //rozmiar uniwersum

			let scene = new THREE.Scene();
			scene.fog = new THREE.FogExp2( 0x111111, 0.0005 );
			let camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 1, unisize*2 );
			let camera2 = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 1, unisize*2 );

			let projector = new THREE.Projector();
			addEventListener( 'mousemove', onMouseMove, false );

			// konfiguracja biblioteki OrbitControls.js
			let controls = new THREE.OrbitControls( camera );
			controls.rotateSpeed = 1.0;
			controls.zoomSpeed = 0.4;
			controls.panSpeed = 0.4; 
			controls.noZoom = false;
			controls.noPan = false;
			controls.dynamicDampingFactor = 0.3;

			// window resize
			window.addEventListener( 'resize', onWindowResize, false );
			function onWindowResize(){
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}

			// wstęp do obsługi ruchy myszy
			let mfc = {x: 0, y: 0};
			let raycaster = new THREE.Raycaster();
			let mouse = { x: 0, y: 0 }, INTERSECTED;
			function onMouseMove( event ) 
				{
					mfc.x = event.clientX;
					mfc.y = event.clientY;
					if (((mfc.x <= settingspanel.offsetWidth) && (mfc.y <= settingspanel.offsetHeight)) || (asidebar.classList == 'infopanelvisible')) {
						controls.enabled = false;
						// console.log("x: "+mfc.x+" y: "+mfc.y);
					} else controls.enabled = true;
					mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
					mouse.y =  -( event.clientY / window.innerHeight ) * 2 + 1;
				}

			let ray = new THREE.Raycaster();
			document.onmousedown = () => {
									name = INTERSECTED.fullname;
									data = INTERSECTED.fullname+'data';
									if(data != 'undefineddata') {
										showasidebar();
										toggleinfobar(eval(name), eval(data)); 
										hidealltrails();
									}
								}
			
			// silnik renderujący obraz
			let renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );
			renderer.shadowMap.enabled = true;
			renderer.setClearColor( 0x000006, 1 );

			// główna kamera
			container = document.getElementById( 'canvas' );
			document.getElementById("plive").appendChild( container );

			// dodatkowa kamera
			renderer2 = new THREE.WebGLRenderer();
			renderer2.setSize( 320, 180 );
			container.appendChild( renderer2.domElement );


			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// IMPLEMENTACJA FUNKCJI TWEEN
			// #region 

				const tweenobject = (mesh, target, multiplier) => {
					let initial = mesh.position;
					let targetpos = {x:0,y:0,z:0};
					// console.log(targetpos);
					targetpos.x = target[0]*multiplier;
					targetpos.z = target[1]*multiplier;
					targetpos.y = target[2]*globaldistanceaspect;
					let tween = new TWEEN.Tween(initial).to(targetpos, delay);
					tween.onUpdate(function(){
						mesh.position.x = initial.x;
						mesh.position.y = initial.y;
						mesh.position.z = initial.z;
					});
					tween.start();
				}

				const cameratween = (position, rotation, controlCenter) => {
					let initialpos = camera.position;
					let targetpos = {x: position.x, y: position.y, z: position.z};
					// console.log("Init: "+initialpos.x+" target: "+targetpos.x);
					let initialrot = camera.rotation;
					let targetrot = {x: rotation.x, y: rotation.y, z: rotation.z};
					controls.center.set(controlCenter.x, controlCenter.y, controlCenter.z);
					// controls.update();
					console.log("Camera movement!");
					let tweenpos = new TWEEN.Tween(initialpos).to(targetpos,1000).easing(TWEEN.Easing.Cubic.InOut);
					tweenpos.onUpdate(function() {
						camera.position.x = initialpos.x;
						camera.position.y = initialpos.y;
						camera.position.z = initialpos.z;
						// camera.lookAt(sun.position);
					});
					let tweenrot = new TWEEN.Tween(initialrot).to(targetrot,1000).easing(TWEEN.Easing.Cubic.InOut);
					tweenrot.onUpdate(function() {
						camera.rotation.x = initialrot.x;
						camera.rotation.y = initialrot.y;
						camera.rotation.z = initialrot.z;
						// camera.lookAt(sun.position);
					});
					// camera.rotation.set(rotation.x, rotation.y, rotation.z);
					tweenpos.start();
					tweenrot.start();
					// togglecambtn();
					console.log("Movement end!");
				}

			//#endregion

			
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// DODAWANIE OBIEKTÓW DO SCENY
			//#region

			//rozmiar Ziemii
			let sizemultiplier = 5;
			let globaldistanceaspect = 200;
			let planetlabelsize = 20;

			//universe
			let unigeo = new THREE.SphereGeometry(unisize, 50, 50);
			let unitexture = new THREE.TextureLoader().load('textures/universe.jpg');
			let unimat = new THREE.MeshBasicMaterial({color: 0xffffff, map: unitexture});
			let universe = new THREE.Mesh(unigeo, unimat);
			universe.material.side = THREE.BackSide;
			scene.add(universe);

			//gwiazdy
			let stars = new THREE.Object3D();
			scene.add(stars);
			let stargeo = new THREE.SphereGeometry( 1, 5, 5);
			let starmat =  new THREE.MeshPhongMaterial( { color:0xFFFFFF} );
			for ( let i = 0; i < 100; i ++ ) {
					let mesh = new THREE.Mesh( stargeo, starmat );
					mesh.position.x = ( Math.random() - 0.5 ) * unisize;
					mesh.position.y = ( Math.random() - 0.5 ) * unisize;
					mesh.position.z = ( Math.random() - 0.5 ) * unisize;
					mesh.updateMatrix();
					mesh.castShadow = false;
					mesh.receiveShadow = false;
					mesh.matrixAutoUpdate = false;
					stars.add( mesh );
				}

			// pas asteroid
			let asteroidbelt = new THREE.Object3D();
			scene.add(asteroidbelt);
			let astrogeo = new THREE.SphereGeometry (1, 4, 4);
			let astromat = new THREE.MeshPhongMaterial ({color: 0xffffff} );
			for ( let i = 0; i < 800; i ++ ) {
				let mesh = new THREE.Mesh( astrogeo, astromat );
				let radius = (Math.random()-0.5)*90+510;
                let randomY = (Math.random()-0.5)*80;
				let posx = Math.cos(i)*radius;
				mesh.position.x = (Math.cos(i))*radius;
				mesh.position.z = (Math.sin(i))*radius;
				mesh.position.y = randomY;
				mesh.castShadow = false;
				mesh.receiveShadow = false;
				mesh.updateMatrix();
				mesh.matrixAutoUpdate = false;
				asteroidbelt.add(mesh);
			}

			// namelabels i geometria planet i pierscieni
			let namelabels = [];
			let planetgeometry = new THREE.SphereGeometry(1,25,25);
			let ringsgeometry = new THREE.SphereGeometry(0.35, 4, 4);

			//slonce + swiatlo
			let sungeo = new THREE.SphereGeometry( 75, 30, 30 );
			let sun = new THREE.PointLight( 0xFFFFFF, 1, 0, 2 );
			let suntexture = new THREE.TextureLoader().load('textures/sunmap.jpg');
			// let sunmaterial = new THREE.MeshBasicMaterial( { color: 0xFFFFFF} );
			let sunmaterial = new THREE.MeshBasicMaterial( { color: 0xFFFFFF, map: suntexture} );
			sun.add( new THREE.Mesh( sungeo, sunmaterial ) );
			sun.castShadow = false;
			sun.receiveShadow = false;
			sun.name = 0;
			sun.fullname = 'sun';
			scene.add( sun );
			sun.position.set(0,0,0);
			//poswiata
			//shader na poswiaty sfer
			let sunglowmat = new THREE.ShaderMaterial( 
			{
				uniforms: 
				{ 
					"c":   { type: "f", value: 0.1 },
					"p":   { type: "f", value: 1.5 },
					glowColor: { type: "c", value: new THREE.Color(0xffcc66) },
					viewVector: { type: "v3", value: camera.position }
				},
				vertexShader:   document.getElementById( 'vertexShader'   ).textContent,
				fragmentShader: document.getElementById( 'fragmentShader' ).textContent,
				side: THREE.FrontSide,
				blending: THREE.AdditiveBlending,
				transparent: true
			}   );
			sunshader = new THREE.Mesh( sungeo.clone(), sunglowmat.clone() );
			sunshader.scale.multiplyScalar(1.2);
			sun.add(sunshader);
			//label z nazwa
			let sunlabel = new SpriteText('Słońce');
			sunlabel.fontFace = 'sans-serif';
			sunlabel.textHeight = planetlabelsize * 1.618;
			// sunlabel.scale.set(35,12,1);
			sunlabel.position.set(0,100,0);
			namelabels.push(sunlabel);
			scene.add(sunlabel);
			sunlabel.fullname = 'sun';

			let ambientlight = new THREE.AmbientLight( 0xFFFFFF, 0.6 );
			scene.add(ambientlight);
		
			// merkury
			let mercurytexture = new THREE.TextureLoader().load('textures/mercurymap.jpg');
			let mercurymat = new THREE.MeshPhongMaterial( { color: 0xFFFFFF, map: mercurytexture} );
			let mercury = new THREE.Mesh(planetgeometry,mercurymat);
			let meinitscale = 9;
			mercury.receiveShadow = false;
			mercury.castShadow = false;
			mercury.name = 1;
			mercury.fullname = 'mercury';
			scene.add(mercury);
			mercury.scale.set(meinitscale,meinitscale,meinitscale);
			//label z nazwa
			let mercurylabel = new SpriteText(PLnames[0]);
			mercurylabel.fontFace = 'sans-serif';
			mercurylabel.textHeight = planetlabelsize;
			namelabels.push(mercurylabel);
			scene.add(mercurylabel);
			mercurylabel.fullname = 'mercury';

			//venus
			let venustexture = new THREE.TextureLoader().load('textures/venusmap.jpg');
			let venusmat = new THREE.MeshPhongMaterial( { color: 0xFFFFFF, map: venustexture} );
			let venus = new THREE.Mesh(planetgeometry,venusmat);
			let veinitscale = 11;
			venus.receiveShadow = false;
			venus.castShadow = false;
			venus.name = 2;
			venus.fullname = 'venus';
			scene.add(venus);
			venus.scale.set(veinitscale,veinitscale,veinitscale);
			//label z nazwa
			let venuslabel = new SpriteText(PLnames[1]);
			venuslabel.fontFace = 'sans-serif';
			venuslabel.textHeight = planetlabelsize;
			namelabels.push(venuslabel);
			scene.add(venuslabel);
			venuslabel.fullname = 'venus';

			//ziemia + ksiezyc
			let earthtexture = new THREE.TextureLoader().load('textures/earthmap1k.jpg');
			let earthm = new THREE.MeshPhongMaterial( { color: 0xFFFFFF, map: earthtexture } );	
			let earth = new THREE.Mesh(planetgeometry,earthm);
			let eainitscale = 12;
			earth.receiveShadow = false;
			earth.castShadow = false;
			earth.name = 3;
			earth.fullname = 'earth';
			scene.add(earth);
			earth.scale.set(eainitscale,eainitscale,eainitscale);
			//label z nazwa
			let earthlabel = new SpriteText(PLnames[2]);
			earthlabel.fontFace = 'sans-serif';
			earthlabel.textHeight = planetlabelsize;
			namelabels.push(earthlabel);
			scene.add(earthlabel);
			earthlabel.fullname = 'earth';
			//atmosfera
			let earthglowmat = new THREE.ShaderMaterial( 
			{
				uniforms: 
				{ 
					"c":   { type: "f", value: 0.1 },
					"p":   { type: "f", value: 0.5 },
					glowColor: { type: "c", value: new THREE.Color(0x005566) },
					viewVector: { type: "v3", value: camera.position }
				},
				vertexShader:   document.getElementById( 'vertexShader'   ).textContent,
				fragmentShader: document.getElementById( 'fragmentShader' ).textContent,
				side: THREE.DoubleSide,
				blending: THREE.AdditiveBlending,
				transparent: true
			}   );
			let eaglowpivot = new THREE.Object3D();
			earthGlow = new THREE.Mesh( planetgeometry.clone(), earthglowmat.clone() );
			earthGlow.scale.multiplyScalar(1.1);
			eaglowpivot.add(earthGlow);
			earth.add( eaglowpivot );
			// księżyc
			let earthPivot = new THREE.Object3D();
			earth.add( earthPivot );
			let moontexture = new THREE.TextureLoader().load('textures/moonmap.jpg');
			let moonmat = new THREE.MeshPhongMaterial( { color: 0xFFFFFF, map: moontexture } );
			let moon = new THREE.Mesh( planetgeometry, moonmat );
			moon.position.x = 3;
			moon.scale.set(0.25, 0.25, 0.25);
			moon.receiveShadow = true;
			earthPivot.add( moon );

			//mars
			let marstexture = new THREE.TextureLoader().load('textures/marsmap.jpg');
			let marsmat = new THREE.MeshPhongMaterial( { color: 0xFFFFFF, map: marstexture } );
			let mars = new THREE.Mesh(planetgeometry,marsmat);
			let mainitscale = 10;
			mars.receiveShadow = false;
			mars.castShadow = false;
			mars.name = 4;
			mars.fullname = 'mars';
			scene.add(mars);
			mars.scale.set(mainitscale,mainitscale,mainitscale);
			//label z nazwa
			let marslabel = new SpriteText(PLnames[3]);
			marslabel.fontFace = 'sans-serif';
			marslabel.textHeight = planetlabelsize;
			namelabels.push(marslabel);
			scene.add(marslabel);
			marslabel.fullname = 'mars';
			let phobosPivot = new THREE.Object3D();
			mars.add( phobosPivot );
			let deimosPivot = new THREE.Object3D();
			mars.add( deimosPivot );
			// let moontexture = new THREE.TextureLoader().load('textures/moonmap.jpg');
			// let moonmat = new THREE.MeshPhongMaterial( { color: 0xFFFFFF, map: moontexture } );
			let phobos = new THREE.Mesh( planetgeometry, moonmat );
			let deimos = new THREE.Mesh( planetgeometry, moonmat );
			phobos.position.x = 2;
			deimos.position.x = -2.8;
			phobos.scale.set(0.25, 0.25, 0.25);
			deimos.scale.set(0.15, 0.15, 0.15);
			phobosPivot.add( phobos );
			deimosPivot.add( deimos );

			// const gltfLoader = new THREE.GLTFLoader();
			// const url = "/models/deimos.glb";
			// gltfLoader.load(url, (glb) => {
			// 	const root = gltf.scene;
			// 	scene.add(root);
			// });



			//jowisz
			let jupitertexture = new THREE.TextureLoader().load('textures/jupitermap.jpg');
			let jupitermat = new THREE.MeshPhongMaterial( { color: 0xFFFFFF, map: jupitertexture } );
			let jupiter = new THREE.Mesh(planetgeometry,jupitermat);
			let juinitscale = 25;
			jupiter.receiveShadow = false;
			jupiter.castShadow = false;
			jupiter.name = 5;
			jupiter.fullname = 'jupiter';
			scene.add(jupiter);
			jupiter.scale.set(juinitscale,juinitscale,juinitscale);
			//label z nazwa
			let jupiterlabel = new SpriteText(PLnames[4]);
			jupiterlabel.fontFace = 'sans-serif';
			jupiterlabel.textHeight = planetlabelsize;
			namelabels.push(jupiterlabel);
			scene.add(jupiterlabel);
			jupiterlabel.fullname = 'jupiter';

			//saturn
			let saturntexture = new THREE.TextureLoader().load('textures/saturnmap.jpg');
			let saturnmat = new THREE.MeshPhongMaterial( { color: 0xFFFFFF, map: saturntexture } );
			let saturn = new THREE.Mesh(planetgeometry,saturnmat);
			let sainitscale = 22;
			saturn.receiveShadow = false;
			saturn.castShadow = false;
			saturn.name = 6;
			saturn.fullname = 'saturn';
			scene.add(saturn);
			saturn.scale.set(sainitscale,sainitscale,sainitscale);
			// pierscienie
			// let saturnringgeo = new THREE.RingGeometry( 1.2, 2.2, 30, 30, 0, Math.PI * 2 );
			let saturnringtexture = new THREE.TextureLoader().load('textures/saturnringcolor.jpg');
			let saturnringmat = new THREE.MeshPhongMaterial( { color: 0xFFFFFF, map: saturnringtexture } );
			let saturnPivot = new THREE.Object3D();
			saturn.add( saturnPivot );
			// saturnPivot.rotation.x = 80;
			for ( let i = 0; i < 200; i ++ ) {
				let mesh = new THREE.Mesh( ringsgeometry, saturnringmat );
				mesh.scale.set(0.1 , 0.1, 0.1);
				let radius = (Math.random()-0.5)*1.2+ 2.2;
                let randomZ = (Math.random()-0.5)*0.2;
				mesh.position.x = (Math.cos(i))*radius;
				mesh.position.z = (Math.sin(i))*radius;
				mesh.position.y = randomZ;
				mesh.castShadow = false;
				mesh.receiveShadow = false;
				mesh.updateMatrix();
				mesh.matrixAutoUpdate = false;
			saturnPivot.add( mesh );
			}
			//label z nazwa
			let saturnlabel = new SpriteText(PLnames[5]);
			saturnlabel.fontFace = 'sans-serif';
			saturnlabel.textHeight = planetlabelsize;
			namelabels.push(saturnlabel);
			scene.add(saturnlabel);
			saturnlabel.fullname = 'saturn';

			//uran
			let uranustexture = new THREE.TextureLoader().load('textures/uranusmap.jpg');
			let uranusmat = new THREE.MeshPhongMaterial( { color: 0xFFFFFF, map: uranustexture } );
			let uranus = new THREE.Mesh(planetgeometry,uranusmat);
			let urinitscale = 20;
			uranus.receiveShadow = false;
			uranus.castShadow = false;
			uranus.name = 7;
			uranus.fullname = 'uranus';
			scene.add(uranus);
			uranus.scale.set(urinitscale,urinitscale,urinitscale);
			// pierscienie
			// let uranusringgeo = new THREE.RingGeometry( 1.2, 2.2, 30, 30, 0, Math.PI * 2 );
			let uranusringtexture = new THREE.TextureLoader().load('textures/uranusringcolour.jpg');
			let uranusringmat = new THREE.MeshPhongMaterial( { color: 0xFFFFFF, map: saturnringtexture } );
			let uranusPivot = new THREE.Object3D();
			// uranus.add( uranusPivot );
			uranusPivot.rotation.x = 80;
			for ( let i = 0; i < 100; i ++ ) {
				let mesh = new THREE.Mesh( ringsgeometry, uranusringmat );
				mesh.scale.set(0.1 , 0.1, 0.1);
				let radius = (Math.random()-0.5)*0.3+1.8;
                let randomZ = (Math.random()-0.5)*0.1;
				mesh.position.x = (Math.cos(i))*radius;
				mesh.position.y = (Math.sin(i))*radius;
				mesh.position.z = randomZ;
				mesh.castShadow = false;
				mesh.receiveShadow = false;
				mesh.updateMatrix();
				mesh.matrixAutoUpdate = false;
			// uranusPivot.add( mesh );
			}
			// label z nazwa
			let uranuslabel = new SpriteText(PLnames[6]);
			uranuslabel.fontFace = 'sans-serif';
			uranuslabel.textHeight = planetlabelsize;
			namelabels.push(uranuslabel);
			scene.add(uranuslabel);
			uranuslabel.fullname = 'uranus';

			//neptun
			let neptunetexture = new THREE.TextureLoader().load('textures/neptunemap.jpg');
			let neptunemat = new THREE.MeshPhongMaterial( { color: 0xFFFFFF, map: neptunetexture } );
			let neptune = new THREE.Mesh(planetgeometry,neptunemat);
			let neinitscale = 18;
			neptune.receiveShadow = false;
			neptune.castShadow = false;
			neptune.name = 8;
			neptune.fullname = 'neptune';
			scene.add(neptune);
			neptune.scale.set(neinitscale,neinitscale,neinitscale);
			//label z nazwa
			let neptunelabel = new SpriteText(PLnames[7]);
			neptunelabel.fontFace = 'sans-serif';
			neptunelabel.textHeight = planetlabelsize;
			namelabels.push(neptunelabel);
			scene.add(neptunelabel);
			neptunelabel.fullname = 'neptune';
			
			// ORBITY
			let metr = new THREE.Object3D();
			let vetr = new THREE.Object3D();
			let eatr = new THREE.Object3D();
			let matr = new THREE.Object3D();
			let jutr = new THREE.Object3D();
			let satr = new THREE.Object3D();
			let urtr = new THREE.Object3D();
			let netr = new THREE.Object3D();
			scene.add(metr,vetr,eatr,matr,jutr,satr,urtr,netr);
			var trailsize = 100;

			//#endregion
		

			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// WSTEPNE USTAWIENIA KAMERY I ZAPISANIE POZYCJI DO JAKIEJ MA WRACAĆ
			// #region
			camera.position.set(-300,1000,550);
			campos = camera.position;
			camera.lookAt (new THREE.Vector3(sun.position.x, sun.position.y, sun.position.z));

			let camToSave = {};
			camToSave.position = camera.position.clone();
			camToSave.rotation = camera.rotation.clone();
			camToSave.controlCenter = controls.center.clone();
			scene.rotation.x = 0.02;
			const resetcameraposition = (position, rotation, controlCenter) => {
					camera.position.set(parseInt(position.x), position.y, position.z);
					camera.rotation.set(rotation.x, rotation.y, rotation.z);
					controls.center.set(controlCenter.x, controlCenter.y, controlCenter.z);
					controls.update();
					togglecambtn();
					render();
				}
			
			camera2.position.set(50,50,50);
			camera2.lookAt(sun.position);

			//#endregion


			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++	
			
const update = function () {
	sunshader.material.uniforms.viewVector.value = new THREE.Vector3().subVectors( camera.position, sunshader.position );
	earthGlow.material.uniforms.viewVector.value = new THREE.Vector3().subVectors( camera.position, earthGlow.position );
}

			// INIT
			const init = function () {
				document.getElementById("timespeed").innerText = 1000/delay;
				document.getElementById("slowdown").innerText = slowdown;
				let sizescale = document.getElementById('psizerange').value;
				document.getElementById('rangeval').innerText = sizescale;
				// georb();
				calcdistances();
				requestAnimationFrame ( animate);
				update();
				// mercury.initpos = mercury.position;
				// venus.initpos = venus.position;
				// earth.initpos = earth.position;
				// mars.initpos = mars.position;
				// jupiter.initpos = jupiter.position;
				// saturn.initpos = saturn.position;
				// uranus.initpos = uranus.position;
				// neptune.initpos = neptune.position;
				let b2 = date.getFullYear(); //year
				let b3 = date.getMonth()+1; //month
				let b4 = date.getDate(); //day
				let b5 = date.getHours(); //hours
				let b6 = date.getMinutes(); //minutes
				updateplanetspositions(b2,b3,b4,b5,b6);

				//NACHYLENIA PLANET:
				mercury.rotation.x = -(mercurydata.axistilt * Math.PI/180);
				venus.rotation.x = -(venusdata.axistilt * Math.PI/180);
				earth.rotation.x = -(earthdata.axistilt * Math.PI/180);
				mars.rotation.x = -(marsdata.axistilt * Math.PI/180);
				jupiter.rotation.x = -(jupiterdata.axistilt * Math.PI/180);
				saturn.rotation.x = -(saturndata.axistilt * Math.PI/180);
				uranus.rotation.x = -(uranusdata.axistilt * Math.PI/180);
				neptune.rotation.x = -(neptunedata.axistilt * Math.PI/180);
			};

			// ANIMATE
			let intersects;
			let name, data;
			const FPS = 20;
			let i = 0;
			let h = 0;
			let mooncycle = 28; //28 dni to cykl ksiezyca
			let slowdown = 5;
			let onerotperframe = (Math.PI / 180) * (360/FPS); //360 stopni na sekunde
			let realearthrotationspeed = onerotperframe * (1000/delay);
			
			var animate = function () {
			TWEEN.update();
			updatelabelspositions();

				// czestotliwosc odswiezania symulacji ( 40 FPS )
				setTimeout( function() {
			        requestAnimationFrame( animate );
				}, 1000/FPS);
				
				setTimeout (function() {
					// RAYCASTER
					ray.setFromCamera( mouse, camera );
					intersects = ray.intersectObjects( scene.children );
						if ( intersects.length > 0 )
						{
							// if the closest object intersected is not the currently stored intersection object
							if ( intersects[ 0 ].object != INTERSECTED ) 
							{
								// restore previous intersection object (if it exists) to its original color
								if ( INTERSECTED ) {
									INTERSECTED.material.color.setHex( INTERSECTED.currentHex );
								}
								//przypisuje interakcje do INTERSECTED
								INTERSECTED = intersects[ 0 ].object;
								// zachowuje pierwotny kolor obiektu
								INTERSECTED.currentHex = INTERSECTED.material.color.getHex();
								// podswietla planete (planety maja ID > 900 dlatego po tym wiem ze nimi są)
								if(INTERSECTED.id > 900)
								{
								INTERSECTED.material.color.setHex( 0xDD0000 );
								}
							}
						} 
						else // nie ma interakcji
						{
							// przywraca kolor jesli nie najezdzamy na nic mysza
							if ( INTERSECTED ) 
								INTERSECTED.material.color.setHex( INTERSECTED.currentHex );
							// resetuje intersekcje
							INTERSECTED = null;
						}
				}, 2*1000/FPS);
				
				//	! CAŁY MOVEMENT (checking of animationstate)

				if(animationstate == true) {
					//ustawienie planet po przeliczeniu ich pozycji (co 8 klatek)
					if(++i % (FPS) == 0) {
						console.log("TIK");
						//wciągnięcie szczegółów daty
						let b2 = date.getFullYear(); //year
						let b3 = date.getMonth()+1; //month
						let b4 = date.getDate(); //day
						let b5 = date.getHours(); //hours
						let b6 = date.getMinutes(); //minutes
						updateplanetspositions(b2,b3,b4,b5,b6);	
						
						addtrail(mercury.position, metr);
						checktrailarraycapacity(metr, parseInt(mercurydata.ows));
						addtrail(venus.position, vetr);
						checktrailarraycapacity(vetr, parseInt(venusdata.ows));
						// epos();
						addtrail(earth.position, eatr);
						checktrailarraycapacity(eatr, parseInt(earthdata.ows));
						addtrail(mars.position, matr);
						checktrailarraycapacity(matr, parseInt(marsdata.ows));
						// jupiterpos();
						addtrail(jupiter.position, jutr);
						checktrailarraycapacity(jutr, parseInt(jupiterdata.ows));
						addtrail(saturn.position, satr);
						checktrailarraycapacity(satr, parseInt(saturndata.ows));
						addtrail(uranus.position, urtr);
						checktrailarraycapacity(urtr, parseInt(uranusdata.ows));
						addtrail(neptune.position, netr);
						checktrailarraycapacity(netr, parseInt(neptunedata.ows));
					
						i = 0;
					}	
					// console.log(i);
					
					// obroty wokol osi (animacja ma 40 klatek na sekundę)
					earth.rotation.y -= realearthrotationspeed / slowdown; //5krotne spowolnienie obrotu ziemii
					earthrotationspeed = realearthrotationspeed / slowdown; 
					earthPivot.rotation.y += (realearthrotationspeed / slowdown) - (realearthrotationspeed / slowdown)/mooncycle;
					mercury.rotation.y -= earthrotationspeed/58.6; // 58.6 dnia
					venus.rotation.y -= earthrotationspeed/243; // 243 dni
					mars.rotation.y -= earthrotationspeed*(24/24.6); // 24h 39m
					phobosPivot.rotation.y += (realearthrotationspeed / slowdown) - (realearthrotationspeed / slowdown)/0.31;
					deimosPivot.rotation.y += (realearthrotationspeed / slowdown) - (realearthrotationspeed / slowdown)/1.26;
					jupiter.rotation.y -= earthrotationspeed*(24/9); // 9h
					saturn.rotation.y -= earthrotationspeed*(24/10.5); // 10h 33m
					saturnPivot.rotation.y += earthrotationspeed*(24/10.5); // 10h 33m
					uranus.rotation.y -= earthrotationspeed*(24/17.25); // 17h 14m
					neptune.rotation.y -= earthrotationspeed*(24/16); // 16h
				} 	
				// ! end of checking animationstate
				// END OF MOVEMENT

				// update wartosci ze slidera/ow
                renderer.render(scene, camera);
				renderer2.render(scene, camera2);
				update();

				if (++h % (FPS*1.5) == 0) {
					if ((parseInt(camera.position.y) < 995) || (parseInt(camera.position.y) > 1005)) {
						camreset.style.opacity = 1;
					} else camreset.style.opacity = 0;
					// pojawienie sie przycisku jesli ruszymy kamera
					if (animationstate == true) {
							document.getElementById("pp").classList.remove('paused');
							hideasidebar();
							// if( eventoccured == true ) {
							// 	earth.material.color.setHex( 0xFFFFFF );
							// 	eval(planet).material.color.setHex( 0xFFFFFF);
							// 	document.querySelector('.eventinfo').innerText = '';
							// 	eventoccured = false;
							// }
						} else {
							document.getElementById("pp").classList.add('paused');
					}
					h = 0;
				}

			};
		
			init();
			animate();

		</script>
	</body>
</html>