<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Solar System v5 - inz</title>
		<style>
			body {
				color: #fff;
				font-family:Monospace;
				font-size:13px;
				text-align:center;
				font-weight: bold;
				background-color: #fff;
				margin: 0px;
				overflow: hidden;
			}
			#info {
				color: white;
				position: absolute;
				top: 0px; width: 100%;
				padding: 5px;
			}
			a {
				color: red;
			}
			.dateinfo {
				color: #FFF;
				position: absolute;
				top: 5px;
				left: 5px;
			}
		</style>
		<link rel="shortcut icon" type="image/x-icon" href="favicon.jpg">
	</head>
	<body>
		<div class="dateinfo" id="infodate"></div>
		<div id="info">
			Symulator eksploracji układu słonecznego - v0.1
		</div>
		<script src="three.min.js"></script>
		<script src="Orbitcontrols.js"></script>
		<script src="Projector.js"></script>
		<script src="math.js"></script>
		<script src="jquery-3.3.1.min.js"></script>
		<script>


				var del=0;
				var scene = new THREE.Scene();
				// scene.fog = new THREE.FogExp2( 0x000022, 0.001 );
				var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 1, 1000 );

				controls = new THREE.OrbitControls( camera );
				controls.rotateSpeed = 1.0;
				controls.zoomSpeed = 1.2;
				controls.panSpeed = 0.8;
				controls.noZoom = false;
				controls.noPan = false;
				controls.staticMoving = true;
				controls.dynamicDampingFactor = 0.3;
				controls.keys = [ 65, 83, 68 ];
				controls.addEventListener( 'change', animate );

				var mouse = { x: 0, y: 0 }, INTERSECTED;

				function onMouseMove( event ) 
				{

					mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
					mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

				}

				var renderer = new THREE.WebGLRenderer();
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.body.appendChild( renderer.domElement );
				renderer.shadowMap.enabled = true;
				renderer.setClearColor( 0x000022, 1 );

				//gwiazdy
				var stargeo = new THREE.SphereGeometry( 1, 9, 9);
				var starmat =  new THREE.MeshPhongMaterial( { color:0xFFFFFF, shading: THREE.FlatShading } );
				for ( var i = 0; i < 100; i ++ ) {
					var mesh = new THREE.Mesh( stargeo, starmat );
					mesh.position.x = ( Math.random() - 0.5 ) * 900;
					mesh.position.y = ( Math.random() - 0.5 ) * 900;
					mesh.position.z = ( Math.random() - 0.5 ) * 900;
					mesh.updateMatrix();
					mesh.matrixAutoUpdate = false;
					scene.add( mesh );
				}

				//slonce
				var sungeo = new THREE.SphereGeometry( 0.01, 50, 50 );
				var sun = new THREE.PointLight( 0xffFFFF, 1.5, 0,2 );
				var sunmaterial = new THREE.MeshBasicMaterial( { color: 0xCCCCCC} );
				sun.add( new THREE.Mesh( sungeo, sunmaterial ) );
				sunmaterial.map = THREE.ImageUtils.loadTexture('textures/sunmap.jpg');
				sun.castShadow = true;
				sun.receiveShadow = false;
				scene.add( sun );
				sun.position.set(0,0,0);
			

				//ziemia + ksiezyc
				var earthg = new THREE.SphereGeometry(0.2,30,30);
				var earthm = new THREE.MeshPhongMaterial( { color: 0xFFFFFF } );
				var moongeo = new THREE.SphereGeometry(1.5,5,5);
				var moonmat = new THREE.MeshPhongMaterial( { color: 0xFFFFFF } );
				var earth = new THREE.Mesh(earthg,earthm);
				earthm.map = THREE.ImageUtils.loadTexture('textures/earthmap1k.jpg');
				//moonmat.map = THREE.ImageUtils.loadTexture('textures/moonmap.jpg');
				earth.receiveShadow = true;
				earth.castShadow = true;
				scene.add(earth);
				// var earthPivot = new THREE.Object3D();
				// earth.add( earthPivot );
				// var moon = new THREE.Mesh( moongeo, moonmat );
				// moon.position.x = 7;
				// moon.receiveShadow = true;
				// earthPivot.add( moon );


				var projector = new THREE.Projector();
				addEventListener( 'mousemove', onMouseMove, false );

				camera.position.x = 5*Math.cos( del );
				camera.position.z = 5*Math.sin( del );
				camera.position.y = 5;
				scene.rotation.x = 0.05;

				//ustawienia kamery
				camera.lookAt (new THREE.Vector3(sun.position.x, sun.position.y, sun.position.z));

				// console.log("Pi: "+cos(pi()));

				// var dd = new Date();
				// // echo(dd);
				// var dn = Date.now();
				// console.log(dn.getFullYear());


				// var date = new Date();
				// console.log(date);
			var date = new Date();	


			window.addEventListener( 'resize', onWindowResize, false );

			function onWindowResize()
			{
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				controls.handleResize();

			    renderer.setSize( window.innerWidth, window.innerHeight );
			}

			var animate = function () 
			{
				
setTimeout( function() {

        requestAnimationFrame( animate );

    }, 1000 );
				// requestAnimationFrame( animate );
				// console.log(czas);
				// var date = new Date();
				// var date = czas.getDate();
				// console.log(date);

				
				
				var year = date.getFullYear();
				var month = date.getMonth()+1;
				var day = date.getDate();
				var hour = date.getHours();
				var minute = date.getMinutes();


				// var countpos = function(year, month, day, hour, minute) {
				var ink = 0;
				var an = 349.2;
				var ph = 102.8517;
				var md = 1;
				var dm = 0.9855796;
				var eksorb = 0.0166967;
				var ml = 328.40353;


				// obliczenia czasowe
				var cej = 2450680.5;
				var el_dnia = 367*year-parseInt(7*(year+parseInt((month+9)/12))/4)+parseInt(275*month/9)+day-730531.5+(hour+(minute/60));
				// console.log(b7);

				// zmiana orbity na radiany
				var inkrad = ink*(Math.PI/180);
				var anrad = an*(Math.PI/180);
				var phrad = ph*(Math.PI/180);
				var dmrad = dm*(Math.PI/180);
				var mlrad =  ml*(Math.PI/180);

				//główne obliczenia
				var mean_anomally = (dmrad*el_dnia+mlrad-phrad)%(2*Math.PI);
				var true_anomally = mean_anomally+(2*eksorb-((eksorb^3)/4)+(5/96)*(eksorb^5))*Math.sin(mean_anomally)+(5*eksorb^2/4-11/24*eksorb^4)*Math.sin(2*mean_anomally)+(13*eksorb^(3/12)-(43/64)*eksorb^5)*Math.sin(3*mean_anomally)+(103/96)*eksorb^4*Math.sin(4*mean_anomally)+(1097/960.0)*eksorb^5*Math.sin(5*mean_anomally);
				var longitude = (true_anomally+phrad)%(2*Math.PI);
				var el_odl = md*(1-eksorb^2)/(1+eksorb*Math.cos(true_anomally));
				var helio_long = Math.atan2(Math.cos(longitude-anrad),Math.sin(longitude-anrad)*Math.cos(inkrad))+anrad;
				var helio_lat = Math.asin(Math.sin(longitude-anrad)*Math.sin(inkrad));

				// console.log(date);

				// wspolrzedne ekliptyczne
				var odl_sun = el_odl*Math.cos(helio_lat);
				var x = odl_sun*Math.cos(helio_long)*Math.cos(helio_lat);
				var y = odl_sun*Math.sin(helio_long)*Math.cos(helio_lat);
				var z = odl_sun*Math.sin(helio_lat);
				console.log(odl_sun);
			// }

			// Math.atan2(y: number, x: number)

				
				// console.log (strdate);

				// var vector = new THREE.Vector3( mouse.x, mouse.y, 1 );
				// // projector.unprojectVector( vector, camera );
				// vector.unproject(camera);
				// var ray = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );

				sun.rotation.x += 0.003;
				sun.rotation.y += 0.001;
				

				earth.position.x = x;
				earth.position.z = y;
				earth.position.y = z;
				earth.rotation.y -= 0.002;	
				// earthPivot.rotation.y = Math.sin(time);
				// earthPivot.rotation.x = Math.cos(time);


				//light.position.set(sun.position.x , sun.position.y , sun.position.z);
				

				var strdate = year+"/"+month+"/"+day+" "+hour+":"+minute;

				renderer.render(scene, camera);
				date.setDate(date.getDate()+1);
				$(".dateinfo").html("Data: "+strdate);
				// return strdate;
			};
			animate();
			
			// var countpos = function(year, month, day, hour, minute) {
			// 	var ink = 0;
			// 	var an = 349.2;
			// 	var ph = 102.8517;
			// 	var md = 1;
			// 	var dm = 0.9855;
			// 	var eksorb = 0.0166;
			// 	var ml = 328.40353;

			// 	var cej = 2450680.5;
			// 	var b7 = 367*year-int(7*(year+int((month+9)/12))/4)+int(275*month/9)+day-730531.5+(hour+(minute/60));
			// 	console.log(b7);
			// }
			
		</script>
	</body>
</html>